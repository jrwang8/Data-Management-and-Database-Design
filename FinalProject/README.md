# Hyper Parameter Project

### Abstract
This project has two main parts where part one is dedicated to create a database that store the metadata and data set details of house sales in king county.
Part 2 is store the hyper parameters that used to perform machine learning on data from part one and their performance. The project 
is part of skunkworks hyper parameter project where more information will be provided.

### House Sales in King County
1. Data for house sales in king county is obtained from [Kaggle.com](https://www.kaggle.com/harlfoxem/housesalesprediction). This data 
will be validated an pre process to assure the credibility and integrity.
2. Data for machine learning models will be generated by our group. The output file is in json where parsing it into scv and import to database is required.
 
### Conceptual Schema
![Conceptual Schema](https://github.com/INFO6105-Spring19/hyperparameter-db-project-db10/blob/master/Conceptual%20Schema/Conceptual.png)
### ERD
![ERD](https://github.com/INFO6105-Spring19/hyperparameter-db-project-db10/blob/master/Conceptual%20Schema/ERD.png)
### Use Cases


```sql
-- use case 1:
-- rank the model by mae
select model_id, mae
from leaderboard
order by mae desc;
```
Query result:

| model_id                                            | mae     |
|:-----------------------------------------------------:|:---------:|
| GLM_grid_1_AutoML_20190416_112303_model_1           |  234075 |
| StackedEnsemble_BestOfFamily_AutoML_20190416_102359 |  232074 |
| StackedEnsemble_BestOfFamily_AutoML_20190416_112303 |  232061 |
| GBM_grid_1_AutoML_20190418_163635_model_1           |  227769 |
| StackedEnsemble_AllModels_AutoML_20190416_102359    |  227757 |
| StackedEnsemble_AllModels_AutoML_20190416_112303    |  226016 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_4  |  180727 |
| GBM_grid_1_AutoML_20190418_165439_model_2           |  176352 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_3  |  149634 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_3  |  117240 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_2  |  115077 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_1  | 93651.4 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_2  | 89142.7 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_1  | 87370.5 |
| DeepLearning_1_AutoML_20190416_102359               | 85999.9 |
| DeepLearning_1_AutoML_20190415_212612               | 84587.3 |
| DRF_1_AutoML_20190416_102359                        | 84240.3 |
| DRF_1_AutoML_20190415_211555                        |   84201 |
| DRF_1_AutoML_20190415_212612                        | 83899.9 |
| DRF_1_AutoML_20190416_112303                        | 83523.4 |
| DRF_1_AutoML_20190415_205714                        |   83389 |
| DeepLearning_1_AutoML_20190416_112303               | 82113.8 |
| GBM_3_AutoML_20190418_163635                        | 81713.8 |
| GBM_grid_1_AutoML_20190418_172432_model_4           | 81623.4 |
| GBM_1_AutoML_20190418_163635                        | 80867.7 |
| GBM_3_AutoML_20190418_165439                        | 80473.1 |
| GBM_1_AutoML_20190418_165439                        | 79508.1 |
| GBM_1_AutoML_20190418_181012                        | 78066.7 |
| GBM_grid_1_AutoML_20190418_165439_model_1           | 76652.1 |
| GBM_grid_1_AutoML_20190418_172432_model_2           | 75119.6 |
| XRT_1_AutoML_20190416_102359                        | 73472.3 |
| XRT_1_AutoML_20190415_212612                        | 73268.3 |
| XRT_1_AutoML_20190416_112303                        | 73008.3 |

```sql
-- use case 2:
-- get the number of paramters of deep learning model
select table_name, count(*) - 1 as countp
from information_schema.columns
where table_schema = 'hyperparameter'
  and table_name = 'DP_hyperparameter';

```
Query result:

| TABLE_NAME        | countp |
|:-------------------:|:--------:|
| DP_hyperparameter |     58 |

```sql
-- use case 3:
-- get the rank of deep learning model by the hyperparamter epochs
select *
from leaderboard
where model_id in (select model_id from DP_hyperparameter order by epochs desc);
```
Query result:

| model_id                                           | mean_residual_deviance | rmse   | mse         | mae     | rmsle    |
|:----------------------------------------------------:|:------------------------:|:--------:|:-------------:|:---------:|:----------:|
| DeepLearning_1_AutoML_20190415_212612              |            20011900000 | 141464 | 20011900000 | 84587.3 | 0.206921 |
| DeepLearning_1_AutoML_20190416_102359              |            20675200000 | 143789 | 20675200000 | 85999.9 | 0.212836 |
| DeepLearning_1_AutoML_20190416_112303              |            18763300000 | 136979 | 18763300000 | 82113.8 | 0.202561 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_1 |            24231800000 | 155666 | 24231800000 | 93651.4 | nan      |
| DeepLearning_grid_1_AutoML_20190416_102359_model_2 |            24373500000 | 156120 | 24373500000 | 89142.7 | 0.210536 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_3 |            35496600000 | 188405 | 35496600000 |  149634 | 0.382594 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_1 |            22604400000 | 150348 | 22604400000 | 87370.5 | nan      |
| DeepLearning_grid_1_AutoML_20190416_112303_model_2 |            34862700000 | 186716 | 34862700000 |  115077 | 0.260986 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_3 |            35139000000 | 187454 | 35139000000 |  117240 | nan      |
| DeepLearning_grid_1_AutoML_20190416_112303_model_4 |            54144200000 | 232689 | 54144200000 |  180727 | 0.460172 |


```sql
-- use case 4:
-- get the rank of GBM model by the hyperparamter seed
select *
from leaderboard
where model_id in (select model_id from GBM_hyperparameter order by seed desc);
```
Query result:

| model_id                                  | mean_residual_deviance | rmse   | mse          | mae     | rmsle    |
|:-------------------------------------------:|:------------------------:|:--------:|:--------------:|:---------:|:----------:|
| GBM_1_AutoML_20190418_163635              |            24080900000 | 155180 |  24080900000 | 80867.7 | 0.193501 |
| GBM_1_AutoML_20190418_165439              |            23652300000 | 153793 |  23652300000 | 79508.1 | 0.19084  |
| GBM_1_AutoML_20190418_181012              |            21499300000 | 146626 |  21499300000 | 78066.7 | 0.189221 |
| GBM_3_AutoML_20190418_163635              |            25264600000 | 158948 |  25264600000 | 81713.8 | 0.195259 |
| GBM_3_AutoML_20190418_165439              |            23826700000 | 154359 |  23826700000 | 80473.1 | 0.193682 |
| GBM_grid_1_AutoML_20190418_163635_model_1 |           128663000000 | 358697 | 128663000000 |  227769 | 0.533564 |
| GBM_grid_1_AutoML_20190418_165439_model_1 |            20425600000 | 142918 |  20425600000 | 76652.1 | 0.186732 |
| GBM_grid_1_AutoML_20190418_165439_model_2 |            82503200000 | 287234 |  82503200000 |  176352 | 0.421342 |
| GBM_grid_1_AutoML_20190418_172432_model_2 |            20059400000 | 141631 |  20059400000 | 75119.6 | 0.183657 |
| GBM_grid_1_AutoML_20190418_172432_model_4 |            22196000000 | 148983 |  22196000000 | 81623.4 | 0.197885 |

```sql
-- use case 5:
-- get the result of the deep learning model when the running time equals to 700s
select *
from leaderboard
where model_id in (select model_id from model_data where runtime = 700);

```
Query result:

| model_id                                           | mean_residual_deviance | rmse   | mse          | mae     | rmsle    |
|:----------------------------------------------------:|:------------------------:|:--------:|:--------------:|:---------:|:----------:|
| DeepLearning_1_AutoML_20190416_102359              |            20675200000 | 143789 |  20675200000 | 85999.9 | 0.212836 |
| DeepLearning_1_AutoML_20190416_112303              |            18763300000 | 136979 |  18763300000 | 82113.8 | 0.202561 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_1 |            24231800000 | 155666 |  24231800000 | 93651.4 | nan      |
| DeepLearning_grid_1_AutoML_20190416_102359_model_2 |            24373500000 | 156120 |  24373500000 | 89142.7 | 0.210536 |
| DRF_1_AutoML_20190416_102359                       |            26824200000 | 163781 |  26824200000 | 84240.3 | 0.201843 |
| GBM_1_AutoML_20190418_181012                       |            21499300000 | 146626 |  21499300000 | 78066.7 | 0.189221 |
| GBM_3_AutoML_20190418_165439                       |            23826700000 | 154359 |  23826700000 | 80473.1 | 0.193682 |
| GBM_grid_1_AutoML_20190418_165439_model_1          |            20425600000 | 142918 |  20425600000 | 76652.1 | 0.186732 |
| GBM_grid_1_AutoML_20190418_172432_model_2          |            20059400000 | 141631 |  20059400000 | 75119.6 | 0.183657 |
| GBM_grid_1_AutoML_20190418_172432_model_4          |            22196000000 | 148983 |  22196000000 | 81623.4 | 0.197885 |
| StackedEnsemble_AllModels_AutoML_20190416_102359   |           128433000000 | 358375 | 128433000000 |  227757 | 0.533376 |
| StackedEnsemble_AllModels_AutoML_20190416_112303   |           126739000000 | 356004 | 126739000000 |  226016 | 0.529407 |
| XRT_1_AutoML_20190416_102359                       |            18302900000 | 135288 |  18302900000 | 73472.3 | 0.184148 |

```sql
-- use case 6:
-- Find the top 3 common used algorithm during all the run
Select model_cat
from model_data
group by model_cat
order by count(*) desc
limit 3;
```
Query result:

| model_cat |
| :---: |
|DeepLearning|
|Gradient Boosting Machine|
|Distributed Random Forest|

```sql
-- use case 7:
-- rank by rmse
select model_id,rmse
from leaderboard
order by rmse desc
limit 5;
```
Query result:

| model_id | rmse|
 | :---: | :---:|
|GLM_grid_1_AutoML_20190416_112303_model_1|367363|
|StackedEnsemble_BestOfFamily_AutoML_20190416_102359|364482|
|StackedEnsemble_BestOfFamily_AutoML_20190416_112303|364461|
|GBM_grid_1_AutoML_20190418_163635_model_1|358697|
|StackedEnsemble_AllModels_AutoML_20190416_102359|358375|

```sql
-- use case 8:
-- show the distinct type of metadata for certain data set
select distinct data_type
from metadata
where data_set_id = 1;
```
Query result:

| data_type |
| :---: |
|float64|
|int64|
|object|

```sql
-- use case 9:
-- show all the possible runtime in current database
select runtime
from model_data
group by runtime
order by count(*) desc;
```
Query result:

| runtime |
|:---------:|
|     700 |
|    1000 |
|     500 |
|     300 |
|     200 |

```sql
-- use case 10:
-- best algorithm category for specific data set
select l.model_cat Model, avg(l.rmse) RMSE, data_info.data_name 'Data Set'
from (select lb.*, md.model_cat, md.data_id
      from leaderboard lb
             right join model_data md on lb.model_id = md.model_id
      where md.data_id = 1) l
       left join data_info on l.data_id = data_info.data_id
group by l.model_cat
order by avg(l.rmse) asc
limit 3;
```
Query result:

| Model                      | RMSE        | Data Set      |
|:----------------------------:|:-------------:|:---------------:|
| Extremely Randomized Trees | 133674.0000 | housing price |
| Distributed Random Forest  | 164143.4000 | housing price |
| DeepLearning               | 167963.0000 | housing price |

### Functions
Function 1
```sql
-- function_1: find if the deep learning model that has the activation of 'Rectifier'
DELIMITER //
create function find_rectifier_dp(id varchar(64))
returns boolean
begin
  declare result text;
  select activation into result from DP_hyperparameter
    where model_id = id;
  return result = 'Rectifier';
end;
//
DELIMITER ;
```

```sql
select find_rectifier_dp('DeepLearning_grid_1_AutoML_20190416_102359_model_2');
```
Query result:

| find_rectifier_dp('DeepLearning_grid_1_AutoML_20190416_102359_model_2') |
|:-------------------------------------------------------------------------:|
|                                                                       0 |

Function 2
```sql
-- function_2: find if the GBM model whose seed is negative
DELIMITER //
create function find_negative_seed_GBM(id varchar(64))
returns boolean
begin
  declare result float;
  select seed into result from GBM_hyperparameter
    where model_id = id;
  return result < 0;
end;
//
DELIMITER ;
```
```sql
select find_negative_seed_GBM('GBM_grid_1_AutoML_20190418_165439_model_1');
```
Query result:

| find_negative_seed_GBM('GBM_grid_1_AutoML_20190418_165439_model_1') |
|:---------------------------------------------------------------------:|
|                                                                   0 |

Function 3
```sql
-- function_3: find the XRT models whose distribution is what we need(like gaussian distribution)
DELIMITER //
create function find_gaussian_distribution_XRT(dis text, id varchar(64))
returns boolean
begin
  declare r text;
  select distribution into r from XRT_hyperparameter
    where model_id = id;
  return r = dis;
end;
//
DELIMITER ;
```
```sql
select find_gaussian_distribution_XRT('gaussian','XRT_1_AutoML_20190416_102359');
```
Query result:

| find_gaussian_distribution_XRT('gaussian','XRT_1_AutoML_20190416_102359') |
|:---------------------------------------------------------------------------:|
|                                                                         1 |

Function 4
```sql
-- function_4: find if the rho of the deep learning model meets the requirements
DELIMITER //
create function find_rho_dp(req float, id varchar(64))
returns boolean
begin
  declare r float;
  select rho into r from DP_hyperparameter
    where model_id = id;
  return r > req;
end;
//
DELIMITER ;
```
```sql
select find_rho_dp(0.99,'DeepLearning_1_AutoML_20190416_112303');
```
Query result:

| find_rho_dp(0.99,'DeepLearning_1_AutoML_20190416_112303') |
|:----------------------------------------------------------:|
|                                                         0 |

### Views
View 1
```sql
-- view_1: find those deep learning models order by rmse.
create or replace view deep_learning_leaderboard as
  select DP_hyperparameter.model_id, leaderboard.rmse
  from DP_hyperparameter left join leaderboard on DP_hyperparameter.model_id = leaderboard.model_id
  order by leaderboard.rmse desc
```
```sql
SELECT * FROM hyperparameter.deep_learning_leaderboard limit 10;
```
Query result:

| model_id                                           | rmse   |
|:----------------------------------------------------:|:--------:|
| DeepLearning_grid_1_AutoML_20190416_112303_model_4 | 232689 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_3 | 188405 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_3 | 187454 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_2 | 186716 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_2 | 156120 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_1 | 155666 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_1 | 150348 |
| DeepLearning_1_AutoML_20190416_102359              | 143789 |
| DeepLearning_1_AutoML_20190415_212612              | 141464 |
| DeepLearning_1_AutoML_20190416_112303              | 136979 |

View 2
```sql
-- view_2: find those GBM models order by mean residual variance
create or replace view GBM_mean_residual as
  select GBM_hyperparameter.model_id, leaderboard.mean_residual_deviance
  from GBM_hyperparameter left join leaderboard on GBM_hyperparameter.model_id = leaderboard.model_id
  order by leaderboard.mean_residual_deviance desc
```
```sql
select * from GBM_mean_residual limit 10;
```
Query result:

| model_id                                  | mean_residual_deviance |
|:----------------------------------------------------:|:--------:|
| GBM_grid_1_AutoML_20190418_163635_model_1 |           128663000000 |
| GBM_grid_1_AutoML_20190418_165439_model_2 |            82503200000 |
| GBM_3_AutoML_20190418_163635              |            25264600000 |
| GBM_1_AutoML_20190418_163635              |            24080900000 |
| GBM_3_AutoML_20190418_165439              |            23826700000 |
| GBM_1_AutoML_20190418_165439              |            23652300000 |
| GBM_grid_1_AutoML_20190418_172432_model_4 |            22196000000 |
| GBM_1_AutoML_20190418_181012              |            21499300000 |
| GBM_grid_1_AutoML_20190418_165439_model_1 |            20425600000 |
| GBM_grid_1_AutoML_20190418_172432_model_2 |            20059400000 |

View 3
```sql
-- view_3: order all models according to the rmse
create or replace view rmse_order as
  select model_id, rmse from leaderboard order by rmse desc
```
```sql
select * from rmse_order limit 10;
```
Query result:

| model_id                                            | rmse   |
|:----------------------------------------------------:|:--------:|
| GLM_grid_1_AutoML_20190416_112303_model_1           | 367363 |
| StackedEnsemble_BestOfFamily_AutoML_20190416_102359 | 364482 |
| StackedEnsemble_BestOfFamily_AutoML_20190416_112303 | 364461 |
| GBM_grid_1_AutoML_20190418_163635_model_1           | 358697 |
| StackedEnsemble_AllModels_AutoML_20190416_102359    | 358375 |
| StackedEnsemble_AllModels_AutoML_20190416_112303    | 356004 |
| GBM_grid_1_AutoML_20190418_165439_model_2           | 287234 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_4  | 232689 |
| DeepLearning_grid_1_AutoML_20190416_102359_model_3  | 188405 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_3  | 187454 |

View 4
```sql
-- view_4: get the rmse of models whose running time equals to 1000s
create or replace view runtime_1000 as
  select leaderboard.model_id, leaderboard.rmse, md.runtime
  from leaderboard left join model_data md on leaderboard.model_id = md.model_id
  where md.runtime = 1000
```
```sql
select * from runtime_1000 limit 10;
```
Query result:

| model_id                                            | rmse   | runtime |
|:----------------------------------------------------:|:--------:|
| DeepLearning_grid_1_AutoML_20190416_102359_model_3  | 188405 |    1000 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_1  | 150348 |    1000 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_2  | 186716 |    1000 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_3  | 187454 |    1000 |
| DeepLearning_grid_1_AutoML_20190416_112303_model_4  | 232689 |    1000 |
| DRF_1_AutoML_20190416_112303                        | 164222 |    1000 |
| GLM_grid_1_AutoML_20190416_112303_model_1           | 367363 |    1000 |
| StackedEnsemble_BestOfFamily_AutoML_20190416_102359 | 364482 |    1000 |
| StackedEnsemble_BestOfFamily_AutoML_20190416_112303 | 364461 |    1000 |
| XRT_1_AutoML_20190416_112303                        | 132969 |    1000 |

### Contribution
Zeyu Zhang: 
>1. Designed the database and draw the conceptual schema
>2. Defined stored hyperparamaters for different machine learning models
>3. Created database and imported data into the database
>4. Performed database normalization
>5. Designed 5 use cases
>6. Modified functions and views
>7. Draw the ER diagram
>8. Write documentation with markdown.

Xuan Shen:
>1. Designed the database
>2. Processed H2O generated result file to csv
>3. Designed 5 use cases
>4. Created 4 functions
>5. Created 4 viewa
>6. Performed database normalization.

### References
1. [H2O Documentation](http://docs.h2o.ai/h2o/latest-stable/h2o-docs/index.html)
2. [Project Sample](https://github.com/prabhuSub/Hyperparamter-Samples) by Prabhu
3. [JSON Library](https://docs.python.org/3.7/library/json.html)
4. [Database Assignments](https://github.com/paulzhang1992/Data-Management-and-Database-Design)
5. [Data Source](https://www.kaggle.com/harlfoxem/housesalesprediction)
### License
Copyright <2019> \<Zeyu Zhang> \<Xuan Shen>

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
