# ABSTRACT
### Assignmnt requirement
In this assignment, you are assumed to be working for a company called Nerd Analytics and that you are
completely in charge of the database. There are 2 parts:
##### Part 1
Your submission must include:
- A domain (e.g. games, film, databases, cartoons, etc.)
- Conceptual models (entities) for a tweet/post, a Social Media user, a person, and a company.
- Conceptual models (entities) that represent consumers, producers and companies in your chosen domain.
- Conceptual models (entities) for at least two things specific to the domain (e.g. a game, a film, a
song, etc.)
- Relationships that connect the entities.
- Appropriate attributes and keys.
- ER diagrams that illustrate the entire conceptual model.
- The ER diagrams can use standard ER symbols or UML.
- 7 following questions.
    1. What are the ranges, data types and format of all of the attributes in your entities?
    2. When should you use an entity versus attribute? (Example: address of a person could be
modeled as either)
    3. When should you use an entity or relationship, and placement of attributes? (Example: a
manager could be modeled as either)
    4. How did you choose your keys? Which are unique?
    5. Did you model hierarchies using the ‚ÄúISA‚Äù design element? Why or why not?
    6. Were there design alternatives? What are their tradeoffs: entity vs. attribute, entity vs.
    relationship, binary vs. ternary relationships?
    7. Where are you going to find real-world data to populate your model?
##### Part 2
Your submission must include:
- Updated ER diagrams that illustrate the entire conceptual model in a form that directly maps to
SQL. You need to either: incorporate the feedback you are given or respond as to why it isn‚Äôt
needed.
- SQL and diagram for the physical model that represents the entire conceptual/physical model.
- SQL that express the queries you are asked to write. Including:\
    a. What user posted this (e.g. tweet, facebook post, IG post, etc.)?\
    b. When did the user post this (e.g. tweet, facebook post, IG post, etc.)?\
    c. What posts has this user posted in the past 24 hours?\
    d. How many post has this user posted in the past 24 hours?\
    e. What keywords/ hashtags are popular?\
    f. What posts are popular?
- At least 5 (10 if two people) distinct use cases of queries that are particular to your domain.
- SQL expressions that express the 5 (10 if two people) use cases of queries that you write.
### Topic and Data
My domain on assignment 2 is about NBA data. Part of my data is from last assignment where I requested with nba_api and scraped from Real GM. 
Other data is also required for this assignment. Tweets data is acquired with tweepy and I also downloaded about 10,000 entries of NBA game details 
about all 30 teams since 1983.

# Project Report
In this part I will explain the details about the project according to all the bullet points given by professor.

#### Part 1 Conceptual Stage

- **A domain**\
This project is about NBA.
- **Conceptual models (entities) for a tweet/post, a Social Media user, a person, and a company.** \
The plan on tweet entities is separate tweets into three entities regarding to the consumers, producers and companies that will mentioned in the next point.
Each entities will have a same model. Attributes should include import information such as id, tweets, time, likes count, and hashtags etc.\
For social media user, the entities will only contain information like their id, user name and screen name(@id for twitter). This is because there
will be less than 100 entries for these entities due to the request limit on my twitter developer account.\
Players ,considered as person , will have attributes such as date of birth, position, weight, height, draft year and in game stats for this entity.
NBA teams are considered as companies in this case where the attributes are founded date, nick name, location and abbreviation.
All the entries will have a ID that is unique within its entity.
- **Conceptual models (entities) that represent consumers, producers and companies in your chosen domain.** \
The companies in my case is 30 NBA teams. The producers are the 20 selected NBA super stars that are know very active on twitter.
Consumers have two main parts, fans and NBA media. They will be spreading or retweeting the news and tweets generated by NBA teams and players.
- **Conceptual models (entities) for at least two things specific to the domain.**\
For this part, my database will contain entities such as all-star games, regular season games, pre season games and post season games.
- **Relationships that connect the entities.**
- **Appropriate attributes and keys.**
- **ER diagrams that illustrate the entire conceptual model.**\
Most entities have a one to one relationship where a few have 0 to 1 or many to many relationship. \
Primary keys for most entities is a unique ID that are pre generated when acquiring the data. These IDs are verified to be unique during the data auditing process.
Some entities such as web scraped data was assigned a unique value as primary key manually.
NBA games and all-star roaster by team is one exception where combination of two id is used as the primary key.\
Details of relation, attributes and keys can be found in ER diagram.
- **7 questions**\
    1. What are the ranges, data types and format of all of the attributes in your entities?\
    The details ot this question can be found in the ER diagram.\
    All the attributes that contain string are text such as name, tweet and location. Where ranges can vary.\
    Numerical values are mostly integer such as block, points, player id and retweet count. The range for play stats are mostly non-negative value that smaller that 100.
    Where player id can as large as million. One exception is for twitter account id, some of the number is so large that double is needed.\
    Date and time is used when their is date involved and float is used for percentage of different shooting.
    2. When should you use an entity versus attribute? (Example: address of a person could be
modeled as either)
    Entities do have a key attribute are considered as weak entities. That's when it should be split into attributes.
    3. When should you use an entity or relationship, and placement of attributes? (Example: a
manager could be modeled as either)
    When the attributes can have relation with in them where a relational entities can explain it easier.
    4. How did you choose your keys? Which are unique?
    Primary keys for most entities is a unique ID that are pre generated when acquiring the data. These IDs are verified to be unique during the data auditing process.
Some entities such as web scraped data was assigned a unique value as primary key manually.
    5. Did you model hierarchies using the ‚ÄúISA‚Äù design element? Why or why not?
    6. Were there design alternatives? What are their trade-offs: entity vs. attribute, entity vs.
    relationship, binary vs. ternary relationships?
    The original design is to use record id instead od combination of two values as primary key for all-star roaster. 
    This way it will consume more space from server anr query some extra data that is not useful.
    NBA team twitter information was designed to be a separate table. Where finally merged with team entity.
    7. Where are you going to find real-world data to populate your model?
    Part of my data is from last assignment where I requested with nba_api and scraped from Real GM. \
    Other data is also required for this assignment. Tweets data is acquired with tweepy and I also downloaded about 10,000 entries of NBA game details 
about all 30 teams since 1983.

#### Part 2 Physical Stage

- **Updated ER diagrams that illustrate the entire conceptual model in a form that directly maps to SQL.** \
The ER diagram is updated after building the physical model. Some relationships are refined and entities are expanded.Details can be found in the final ERD.
- **SQL and diagram for the physical model that represents the entire conceptual/physical model.**\
The SQL and diagrams are located in the database folder.
- SQL that express the queries you are asked to write. Including:\
    a. What user posted this (e.g. tweet, facebook post, IG post, etc.)?\
    This can be find by using the script such as
    ```mysql
    SELECT USER_NAME FROM tweets_team
      WHERE TWEET = "Clear the runway for @Double0AG üõ´ https://t.co/MRbdVVGFRi";
    ```
    This will return something like this:
    
    | USER_NAME     | 
    | :-----: |
    | Orlando Magic |

    ```mysql
    SELECT USER_NAME FROM tweets_team
      WHERE TWEET like "Clear the runway for %";
    ```
    This will return something like this:
    
    | USER_NAME            | 
    | :-----: |
    | Orlando Magic        |
    | Orlando Magic        |
    | Orlando Magic        |
    | Los Angeles Lakers   |
    
    b. When did the user post this (e.g. tweet, facebook post, IG post, etc.)?\
    ```mysql
    SELECT CREATED_AT FROM tweets_team
      WHERE TWEET like "Clear the runway for %";
    ```
    This will return something like this:
    
    |      CREATED_AT     | 
    | :-----: |
    | 2018-01-19 00:35:11 |
    | 2018-02-07 02:02:44 |
    | 2018-11-08 00:18:56 |
    | 2018-12-11 04:41:23 |
    ```mysql
    SELECT YEAR(CREATED_AT),MONTH(CREATED_AT),DAY(CREATED_AT),HOUR(CREATED_AT),MINUTE(CREATED_AT), SECOND(CREATED_AT)
      FROM tweets_team
      WHERE TWEET like "Clear the runway for %";
    ``` 
    This will return something like this:
    
    |YEAR(CREATED_AT)| MONTH(CREATED_AT)| DAY(CREATED_AT)| HOUR(CREATED_AT)| MINUTE(CREATED_AT)|  SECOND(CREATED_AT) |
    | :-----: |:-----: |:-----: |:-----: |:-----: |:-----: |
    | 2018 | 1 | 19 | 0 | 35 | 11 |
    | 2018 | 2 | 7 | 2 | 2 | 44 |
    | 2018 | 11 | 8 | 0 | 18 | 56 |
    | 2018 | 12 | 11 | 4 | 41 | 23 |

    c. What posts has this user posted in the past 24 hours?\
    Since the post in our data base are not live, I need to find the newest post in the data base.
    ```mysql
    SELECT CREATED_AT,TWEET,USER_NAME FROM tweets_team
      ORDER BY CREATED_AT DESC LIMIT 10;
    ``` 
    Query result:
    
    | CREATED_AT | TWEET | USER_NAME |
    | :-----: |:-----: |:-----: |
    |2019-02-18 19:49:48|"Jrue Holiday is ranked 3rd in the #NBA in APG (7.9), 12th in SPG (1.6) and 21st in PPG (21.1).Some of his top pla‚Ä¶ https://t.co/Udpih0b1CD" | New Orleans Pelicans|
    |2019-02-18 19:49:24|	"üìù City of Charlotte, @NBA Put on Spectacular Show for #NBAAllStar Weekend üôåüèº #Hornets30 üëâüèº https://t.co/nhWvtzTieM https://t.co/VjzyfCIgTP" |	Charlotte Hornets|
    |2019-02-18 19:45:55|	When you realize there‚Äôs no NBA games until Thursday..... https://t.co/IeQbw8gyqw |	Memphis Grizzlies|
    |2019-02-18 19:30:00|	üì∏: Pure Art üë®‚Äçüé® https://t.co/02gVdix5hg |	Orlando Magic|
    |2019-02-18 19:30:00|	"This year was different because I felt settled. I was more comfortable than I had been the first three times. I‚Äôm‚Ä¶ https://t.co/H1KMHmt33Q |	Trail Blazers|
    |2019-02-18 19:22:00|	"Khris lights up #NBAAllStar for 20 points!! #KhrisMiddleton https://t.co/v9QEa5VViW"|	Milwaukee Bucks|
    |2019-02-18 19:08:35|	"Joe Ingles tells us what makes being a dad so awesome. (Hint: it‚Äôs not the sleepless nights.)üé•:‚Ä¶ https://t.co/WdoXmaejFj" |	Utah Jazz|
    |2019-02-18 19:03:00|	"DIALED IN üìû@d_dedmon3 got loose, going 4-7 from deep against the @nyknicks to earn this week's @scanaenergy Hot Sh‚Ä¶ https://t.co/58zmFz3x4V"	| Atlanta Hawks|
    |2019-02-18 19:01:00|	"""As far back as I can remember, I always wanted to be a Three-Point Contest champion.""üé• Joey Buckets x Goodfellas‚Ä¶ https://t.co/BFqf7h3SnU" |	Brooklyn Nets|
    |2019-02-18 19:00:00|	"""I think it's really good for the organization. I think it's really good for me. It's a win-win for everybody.""üì∏‚Ä¶ https://t.co/Nchw7mka2O"	| Denver Nuggets|
    
    Now I'm choosing New Orleans Pelicans as my targeted user.  
    ```mysql
    SELECT CREATED_AT, TWEET, USER_NAME, RETWEET_COUNT, FAVORITE_COUNT, HASHTAGS
      FROM tweets_team
      /*
      2 constrains, less than 24 hours and from pelicans
      time >= latest time by pelicans 
      SELECT DATE_SUB(latest time, 24 hours)
      latest time = SELECT MAX(CREATED_AT) FROM tweets_team
                      WHERE USER_NAME = "New Orleans Pelicans"
      */
      WHERE (CREATED_AT
                >= (SELECT DATE_SUB((
                  SELECT MAX(CREATED_AT)
                  FROM tweets_team
                  WHERE USER_NAME = "New Orleans Pelicans")
                  ,INTERVAL 24 HOUR))
               AND USER_NAME = "New Orleans Pelicans")
      ORDER BY CREATED_AT DESC;
    ```     
    Query result:
    
    | CREATED_AT | TWEET | USER_NAME |RETWEET_COUNT | FAVORITE_COUNT | HASHTAGS |
    | :-----: |:-----: |:-----: | :-----: | :-----: | :-----: |
    |2019-02-18 19:49:48|	"Jrue Holiday is ranked 3rd in the #NBA in APG (7.9), 12th in SPG (1.6) and 21st in PPG (21.1). Some of his top pla‚Ä¶ https://t.co/Udpih0b1CD" |	New Orleans Pelicans |	14 |	44 |	['NBA'] |
    |2019-02-18 15:30:00|	"Want to win #Pelicans loge tickets?! RETWEET for a chance to win courtesy of @Sprite! OR post a photo with‚Ä¶ https://t.co/H8Y3xOO4iz" |	New Orleans Pelicans |	49 |	31 |	['Pelicans'] |
    |2019-02-18 02:01:32|	@ToddShamTodd YEP! |	New Orleans Pelicans |	1 |	0 |	['Pelicans'] |
    |2019-02-18 01:59:05|	AD for 3! #NBAAllStar https://t.co/0obudh0ba9 |	New Orleans Pelicans |	16 |	107 |	['NBAAllStar'] |
    |2019-02-18 01:55:01|	AD with the reverse! #NBAAllStar https://t.co/SzyMVJmSvI |	New Orleans Pelicans |	25 |	317 |	['NBAAllStar'] |
    |2019-02-18 01:19:04|	"AD's #NBAAllStar intro üèÄ¬† (via @NBAonTNT) https://t.co/1E0DA4Zxks" |	New Orleans Pelicans |	19 |	100 |	['NBAAllStar'] |
    |2019-02-18 01:04:46|	"""I am going to do a couple James' stepbacks in this game - see if they call travel on me,"" - AD üòè #NBAAllStar  (vi‚Ä¶ https://t.co/mC2UJ30U0F" |	New Orleans Pelicans |	67	| 397 |	['NBAAllStar'] |
    |2019-02-18 00:50:21|	AD's #NBAAllStar kicks https://t.co/n0GXwgYfE7 |	New Orleans Pelicans |	27 |	159 |	['NBAAllStar'] |
    |2019-02-17 22:13:04|	RT @ETwaun55: üôèüèæ https://t.co/HEmpxWTg3x |	New Orleans Pelicans |	74 |	0	| ['NBAAllStar'] |

    d. How many post has this user posted in the past 24 hours?\
    For this question, selecting tweet from last 24 hour by pelicans can be reused. Just use count method to get the total numbers.
     ```mysql
    SELECT COUNT(*), USER_NAME
      FROM tweets_team
      WHERE (CREATED_AT
                >= (SELECT DATE_SUB((
                  SELECT MAX(CREATED_AT)
                  FROM tweets_team
                  WHERE USER_NAME = "New Orleans Pelicans")
                  ,INTERVAL 24 HOUR))
               AND USER_NAME = "New Orleans Pelicans")
      GROUP BY USER_NAME;
    ```     
    Query result: 

    | TWEET | USER_NAME |
    | :-----: |:-----: |
    | 9 |  New Orleans Pelicans |
  
    e. What keywords/ hashtags are popular?\
    f. What posts are popular?
- At least 5 (10 if two people) distinct use cases of queries that are particular to your domain.
- SQL expressions that express the 5 (10 if two people) use cases of queries that you write.

# References
#### [tweepy](https://tweepy.readthedocs.io/en/v3.5.0/index.html)
Last accessed on Feb.13.2019
#### [Twitter Developer](https://developer.twitter.com/en/docs)
Last accessed on Feb.13.2019
#### [Twitter Developer Doc](https://developer.twitter.com/en/docs)
[Tweet Management](https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/tweet-object.html)\
[List Management](https://developer.twitter.com/en/docs/accounts-and-users/create-manage-lists/api-reference/get-lists-members)\
[Timeline](https://developer.twitter.com/en/docs/tweets/timelines/overview)\
Last accessed on Feb.13.2019
#### [NBA players' twitter](https://www.basketball-reference.com/friv/twitter.html)
Last accessed on Feb.18.2019
#### [Pandas documentation](https://pandas.pydata.org/pandas-docs/stable/index.html)
Last accessed on Jan.22.2019
#### [MySQL Mannul](https://dev.mysql.com/doc/refman/8.0/en/load-data.html)
Last accessed on Feb.19.2019
#### Tweepy example
MINING FOR TWEETS by ALEXANDER GALEA: [Link](https://galeascience.wordpress.com/2016/03/18/collecting-twitter-data-with-python/)\
Last accessed on Feb.13.2019\
Tutorial example by Prof.Brown: [Link](https://github.com/nikbearbrown/INFO_6210/blob/master/Week_2/NBB_%20BeautifulSoup.ipynb)\
Last accessed on Feb.13.2019\
Dump all tweets as CSV of given twitter handle using #Tweepy by arulrajnet: [Link](https://gist.github.com/arulrajnet/0b71842b573d81c7bc23)\
Last accessed on Feb.13.2019
#### Python tutorial
Python Tutorial from : [Link](https://www.w3schools.com/python/python_operators.asp)\
Last accessed on Jan.19.2019

# License
Copyright <2019> \<Zeyu Zhang>

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.